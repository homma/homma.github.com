# はじめに
- 初学者なので、以下の内容は間違いを含んでいる可能性が大いにあります。。。

# きっかけ
- 楽器の演奏に興味があった

- いつでも気軽に演奏したく、移動中の電車の中や散歩中、帰宅後の夜遅い時間でも演奏できる楽器が欲しかった
- いつでも演奏可能なら練習量も増やせる
- 電車の中や夜中に周りに迷惑にならずに演奏するには、イヤフォン経由で音を出せる楽器が必要
- そのためには、生音が出る楽器だと難しい
- 電子楽器が良さそう

- イヤフォン出力のある電子楽器で、入手性が良くて、値段も張らず、演奏が簡単そうで、色んな楽曲を演奏できる音域があって、持ち運びが出来るくらい軽量小型な物が欲しい
- 探してみたが、そんな都合のいい物は見つからなかった
- 無いなら自作するべ

- iPhone のアプリとして作ることも考えたが、物理スイッチの無い iPhone では演奏時に画面を見ることが半ば必須で、外を歩きながら演奏するには不向き
- 画面を見ながらだと、歩きスマホ的な感じになってしまって危険

- iPhone 対応の Bluetooth キーボードを物理スイッチとして代用することは可能
- キータッチが柔らかくて、キーの間が適度に空いていて、軽くて小さくて、複数キーの同時押しが可能な物があれば、いいかもしれない
- 探してみた感じでは、楽器の入力キーに良さそうなキーボードは見つからなかった

- 以前から何となく面白そうだなと思っていたマイコンの勉強にちょうどいいかも
- とりあえずマイコンで出来るか調べてみよう

# 補足
- 口笛的な気軽さで、自転車に乗りながらでも演奏出来たら嬉しいけど、それは実現が難しそうなので、あきらめる

# 学んだこと、気づいたこと

## マイコンについて
- マイコンは PIC や AVR や ARM がある
- AVR ベースの Arduino を使うといいらしい
- Arduino は、メジャーで情報がそろっていて、開発環境がマルチプラットフォームで用意されていて、C で開発できて、USB がついているのでプログラムの書き込みも簡単

- パソコンの延長で使える Raspberry Pi も良さそうですが、消費電力的に Arduino に分があった
- 持ち運べる楽器を作る場合に、バッテリーを充電する頻度が大きいのはデメリット
- Raspberry Pi は手順を踏んでシャットダウンする必要がある
- Raspberry Pi は ARM ベース
- 他に BeagleBoard や PandaBoard という物もある

## マイコン入門に付いて
- マイコンのチュートリアルは必ず LED 点灯から始まる
- プログラミングで言うと Hello World! 的な位置づけみたい
- 「習うより慣れろ」の慣れる部分

- 電子工作そのものに興味があるというよりは、電子工作で自分のやりたいことが実現できるかに興味があったので、LED 点灯は正直あまり興味が持てなかった
- 初心者で知識が無かったので、LED を点灯させる技術が自分のやりたいことにどう繋がって行くのかイメージが湧かなかった
- 音を鳴らすところから始まるチュートリアルがあったら良いのにな〜

## マイコンの仕組み - ピン
- マイコンでは、一つの入出力ピンが、一つの電気信号の入出力先に対応するみたい
- 基本的には、入力スイッチ一つに一つのピンを対応させる感じ
- 10 個のスイッチが必要であれば 10 個のピンが必要
- ピン数が足りなくなった場合は工夫をすることも可能（後述）

- GND は Ground で、電池のマイナス極みたいなもので、回路を閉じるのに必ず接続する必要がある

## Arduino の入出力ピンについて
- デジタル入出力ピンとアナログ入力ピンがある
- デジタルピンは 1 / 0 の入力・出力が可能
- アナログピンは多段階の数値の読み取りが可能
- アナログピンはデジタルピンに変更可能（Arduino のモデル毎に仕様の確認が必要）

- Arduino Uno に付いている入出力ピンは 20 個（アナログ入力ピン 6 個を含む）
- これで楽器を作るにはピンが足りなくなるので、対処が必要（後述）
- 一方 Adruino Mega は入出力ピンが 70 個（デジタル入出力 56 + アナログ入力 14）ある
- 70 ピンあれば、5 オクターブ分(1 オクターブ 12 音 x 5 + 1 = 61) の入力が可能
- ただし Uno より Mega の方が値段が高い
- Uno と Mega の電力消費の違いに付いては未確認

## 回路の作成
- 最初のうちはブレッドボードを使えば、半田付けが不要で、試行錯誤できる
- いずれは半田付けは必須になってくる
- プリント基板の自作はちょっとハードルが高そう（今の段階で考える必要はなさそうですが）

- 回路図をマークアップ言語や DSL から生成できると楽そうですが、そういうプログラムは見つかりませんでした

## マイコンで音を鳴らす例
- 電子楽器は『電子オルガン』を作っている人が多く、簡単な物は簡単に作れる（重要）らしい
- ただし、出せる音が 1 オクターブの物がほとんどで、和音や音色の変更は考慮されていない
- 音鳴らし系のサンプルでは『電子オルゴール』も多い

- 『電子ピアノ』ではなく『電子オルガン』なのは、キーを押す強さで音の大きさを変更することが出来ないからかな?

## マイコンで音を鳴らす装置
- マイコンで音を出す作例は『圧電ブザー』を使用したものが多く、イヤフォン出力の解説はあまりなかった
- イヤフォン出力は、秋月電子の『３．５ｍｍステレオミニジャックＤＩＰ化キット』を使うといいらしい
- ただし、DIP 化キットは半田付け必須
- アンプを通す必要がある場合は『オーディオアンプキット』を探すといいらしい
- Raspberry Pi なら最初からステレオミニジャックが付いている

## マイコンに入力する
- 電子オルガンの作例ではタクトスイッチが使用されていることが多いようでした
- 基本は、マイコン側の一つの入力ピンに対し、タクトスイッチが一つ必要になる
- ピンの数が足りない場合は対処が必要

- Arduino のサンプルには圧力センサーを入力にする例があった
- 圧力センサーを使えば、押す力の強さによって音の大きさを変えるような実装も可能かもしれない

- 今のところはタクトスイッチで問題なさそう
- より楽器的な入力装置についてはまた改めて必要になったら検討する

## ピン数が足りない場合
- ピンの数が足りない場合は、キーマトリックスを組んでスキャンする、シフトレジスタを使って複数の入力をシリアル化する、抵抗分圧回路を作ってアナログピンを読み取るなど、色々な方法がある
- ただし、スイッチの同時押しを可能にする為には、それを考慮した方法を採用する必要がある
- 同時押しが必要であれば、シフトレジスタを使用する方法が良さそう
- 必要なら試してみよう

- マイコン的に凝ったことがしたい訳ではなく、楽器を作りたいだけので、最初からピン数が多い Arduino Mega を使うのがいいかもしれない
- マイコン : 手段、楽器 : 目的
- でもシフトレジスタは面白そう
- シフトレジスタを使った方がコストも抑えられるし

## 鳴らす音について
- Arduino で音を出すには tone 関数を使用するのが簡単
- ただし、tone 関数では和音は出せないし、波形もいじれない
- tone 関数の代わりに、PWM 出力が可能なピンに analogWrite 関数で音を書き込めばいいみたい

# これから
- Arduino のサイトにあるチュートリアルを読んで勉強する
- ネット上の作例を調べる
- 実際に実機で試してみる

# さいごに
- 電子工作の面白さが今まで良くわかっていませんでしたが、作りたいものがあって、それに向けて取り組むと面白いですね
